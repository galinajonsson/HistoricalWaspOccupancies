---
title: "Summaries"
author: "Galina M. Jönsson"
date: "17/01/2020"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---

### Rhat
First I test whether all models' occupancy estimates have converged (Rhat<1.1) using the function summarise_Rhat (see function description in function-summarise_Rhat.R for details).
```{r summary-rhat, message=FALSE}
# Load packages
library(knitr)
library(kableExtra)

# Load the function
source("../analyses/function-summarise_Rhat.R")

# Run function to find whether model estimates have converged or not
RhatSum <- summarise_Rhat("../outputs/modelOutputs")

# Show summary tables
kable(RhatSum) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```
The table shows that all V. germanica (file names ending with "_vg.rds") at 1 year temporal resolutions (file names ending with "year_vg.rds") have not converged. 

### Sample sizes
Load the tables summarising sample sizes, remove __V. germanica__ ouputs at 1 year temporal resolutions and show the tables. 
```{r summary-tables, cache=TRUE, message=FALSE}
# Load packages
library("boot")

# Load summary tables
modelSummary <- read.csv("../outputs/SummaryTables/modelSummary.csv", header=T, as.is = TRUE, na.strings=c("","NA")) 
sppLevelSummary <- read.csv("../outputs/SummaryTables/sppLevelSummary.csv", header=T, as.is = TRUE, na.strings=c("","NA")) 

# Remove V. germanica ouputs at 1 year temporal resolutions
sppLevelSummary <- sppLevelSummary  %>% 
  filter(!(Species=="Vespula germanica" & closurePer=="1yr"))

# Show summary tables
kable(sppLevelSummary) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

kable(modelSummary) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```


### Annual most northerly grid cells
Here, we summarise the 10 most northerly grid cells recorded each year per species and plot the annual range of these grid cells' latitude. 


Could easily take the 10 most northerly grid cells recorded each year and plot over time. Acknowledging that it’s biased, it would still provide supporting evidence.

//

Insert supp material with something sime like 10th percentile of records per decade on maps or so

```{r summary-tables, cache=TRUE, message=FALSE}
# Load packages
library("sparta")



# Load the formatted data used in analyses
spp_vis <- read.csv('../outputs/formattedData/spp_vis_merged_1kmgrid_date_year.csv', header=T, na.strings=c("","NA"))

# Subset each species into separate data frames
spp_vis_crabro <- subset(spp_vis, Vespa.crabro == "TRUE")
spp_vis_crabro$species <- c("Vespa crabro")
spp_vis_germanica <- subset(spp_vis, Vespula.germanica == "TRUE")
spp_vis_germanica$species <- c("Vespula germanica")
spp_vis_vulgaris <- subset(spp_vis, Vespula.vulgaris == "TRUE")
spp_vis_vulgaris$species <- c("Vespula vulgaris")

# Subset the first six characters of the "visit" column, which corresponds to the grid cell
spp_vis_crabro$gridcell <- substr(spp_vis_crabro$visit, start = 1, stop = 6)
spp_vis_germanica$gridcell <- substr(spp_vis_germanica$visit, start = 1, stop = 6)
spp_vis_vulgaris$gridcell <- substr(spp_vis_vulgaris$visit, start = 1, stop = 6)

# Subset the first six characters of the "visit" column, which corresponds to the grid cell
spp_vis_crabro$year <- as.factor(substr(spp_vis_crabro$visit, start = 14, stop = 17))
spp_vis_germanica$year <- as.factor(substr(spp_vis_germanica$visit, start = 14, stop = 17))
spp_vis_vulgaris$year <- as.factor(substr(spp_vis_vulgaris$visit, start = 14, stop = 17))

x <- spp_vis_crabro
x$latitude <- as.numeric(NA)
nrow <- nrow(x)
years <- unique(x$year)

for(i in 1:nrow){
  x[i, "latitude"] <- (gr2gps_latlon(x[i, "gridcell"]))$LATITUDE
}

df.max <- ddply(x, c("year"), subset, order(latitude,decreasing=TRUE) <= 5)


plot(as.numeric(as.character(df.max$year)), df.max$latitude, xlab = "Year", ylab="Latitude (degrees)", ylim = c(50,55))



```